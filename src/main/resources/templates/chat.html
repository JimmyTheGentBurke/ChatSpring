<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <title>SpringChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/./assets/css/styleChat.css">
</head>
<body>
<main class="content">
    <div class="container p-0" id="mainPag">
        <div class="card">
            <div class="row g-0">
                <div class="col-12 col-lg-5 col-xl-3 border-right">
                    <div class="px-4 px-4 border-bottom d-none d-md-block">
                        <div class="d-flex align-items-center">
                            <div class="flex-grow-1">
                                <form th:action="@{'/chat/v4' + '#chatFromSearch'}" method="post">
                                    <label class="input-label2">
                                        <input name="nickname" type="text" required="required"
                                               class="form-control my-3" placeholder="Nickname">
                                    </label>
                                    <button class="btn btn-primary" type="submit">Search</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!--                    CHATS-->
                    <div class="chat-messages2">
                        <div th:each="chat : ${chats}" class="">
                            <a th:href="@{/message(chatId = ${chat.id}) }"
                               class="list-group-item list-group-item-action border-0">
                                <div class="d-flex align-items-start">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSByqDp5N_AYCT_DIFPTONelbRMNZC2jZerMsG4XRdAsCu9CAGmTlv1_AIpXkOa6iFaAiQ&usqp=CAU"
                                         class="rounded-circle mr-1" alt="Vanessa Tucker" width="40" height="40">
                                    <div class="flex-grow-1 ml-3" th:text="${chat.name}">
                                        <span th:text="${chat.creator.getNickname()}"></span>
                                        <div class="small"><span class="fas fa-circle chat-online"></span> Online</div>
                                    </div>
                                    <div>
                                        <form th:action="@{/chat/v5(chatId = ${chat.id})}" method="post">
                                            <button type="submit" class="btn-primary2"><img
                                                    src="https://cdn-icons-png.flaticon.com/512/2782/2782988.png"
                                                    width="20" height="20" alt="Button"></button>
                                        </form>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!--                    CHATS-->

                <!--                        NAVIGATION-->

                    <hr class="d-block d-lg-none mt-1 mb-0">
                </div>
                <div class="col-12 col-lg-7 col-xl-9">
                    <div class="py-2 px-4 border-bottom d-none d-lg-block">
                        <div class="d-flex align-items-center py-1">
                            <div class="flex-grow-1 pl-3">
                                <div th:if="${user.orElseThrow().id !=  resipient.id}"
                                     th:each="resipient : ${recipients}" class="flex-grow-1 pl-3">
                                    <var th:text="${resipient.nickname}"></var>
                                    <form th:action="@{/chat/v6 (recipientId = ${resipient.id}, chatId = ${param.chatId})}"
                                          method="post" class="flex-grow-2 pl-3">
                                        <button type="submit" class="btn-primary2"><img
                                                src="https://cdn-icons-png.flaticon.com/512/594/594598.png" height="10"
                                                width="10"></button>
                                    </form>
                                </div>
                            </div>
                            <div>
                                <a th:href="@{/user}">
                                    <button class="btn btn-primary" type="submit">My account</button>
                                </a>
                            </div>
                            <div>
                                <form action="/logout" method="post">
                                    <button type="submit" class="btn btn-primary">Logout</button>
                                </form>
                            </div>
                            <div th:if="${messages} != null">
                                <a href="#AddNewUser">
                                    <button class="btn btn-primary" type="submit">Add User</button>
                                </a>
                            </div>
                            <div>
                                <a href="#drop-window">
                                    <button class="btn btn-primary" type="submit">Create new Chat</button>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!--                        NAVIGATION-->

                    <!--                    MESSAGES-->

                    <div class="position-relative message-content">
                        <div class="chat-messages p-4 messages-place">
                            <div th:if="${errorsParam}">
                                <p style="color: red" th:each="error :${errorsParam}" th:text="${error}"> Error
                                    message</p>
                            </div>

                            <!-- Drop Window Creation Of Chat P2P-->

                            <div id="drop-window">
                                <div id="window">
                                    <form th:action="@{/chat/v1}" class="pop-up-window"
                                          method="post">
                                        <label for="chatName">
                                            Chat name: <input id="chatName" type="text" required="required"
                                                              name="chatName">
                                        </label>
                                        <br>
                                        <label for="recipientName">
                                            Recipient: <input id="recipientName" type="text" required="required"
                                                              name="recipientName">
                                        </label>
                                        <br>
                                        <button type="submit" class="btn btn-primary">Create chat</button>
                                    </form>
                                    <br>
                                    <a href="#" class="btn btn-primary">Close</a>
                                </div>
                            </div>

                            <!-- Drop Window Creation Of Chat P2P-->

                            <div id="AddNewUser">
                                <div id="Adduser">
                                    <form th:action="@{/chat/v2}" class="pop-up-window"
                                          method="post">
                                        <label for="chatName">
                                            User name: <input id="username" required="required" type="text"
                                                              name="username">
                                        </label>
                                        <input type="hidden" name="chatId" required="required"
                                               th:value="${param.chatId}">
                                        <button type="submit" class="btn btn-primary">Add User</button>
                                        <a href="#" class="btn btn-primary">Close</a>
                                    </form>
                                </div>
                            </div>

                            <!--                             Drop window            -->

                            <div id="chatFromSearch">
                                <div id="windowFromSearch" th:if="${searchByNickName}">
                                    <div class="d-flex align-items-start">
                                        <img src="https://bootdey.com/img/Content/avatar/avatar5.png"
                                             class="rounded-circle mr-1" alt="Vanessa Tucker" width="40" height="40">
                                        <div class="flex-grow-1 ml-3">
                                            <span th:text="${searchByNickName.orElseThrow().nickname}"></span>
                                        </div>
                                    </div>
                                    <form th:action="@{/chat/v3(userIdCreateSearch = ${searchByNickName.orElseThrow().id})}"
                                          method="post">
                                        <label for="chatName">
                                            Chat name: <input id="createChatFromSearch" type="text"
                                                              name="chatName">
                                        </label>
                                        <input type="hidden" name="userId"
                                               th:value="${param.userIdCreateSearch}">
                                        <br>
                                        <button type="submit" class="btn btn-primary">Create new chat</button>
                                        <a href="#" class="btn btn-primary">Close</a>
                                    </form>
                                </div>
                            </div>

                            <!--                            Drop Window Creation Of Chat P2P-->

                            <!--                            MESSAGES                        -->

                            <div th:each="message : ${messages}">
                                <div class="chat-message-right pb-4"
                                     th:if="${message.creator.id == user.orElseThrow().id}">
                                    <div>
                                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png"
                                             class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
                                        <div class="text-muted small text-nowrap mt-2">2:33 am</div>
                                    </div>
                                    <div class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
                                        <div class="font-weight-bold mb-1"
                                             th:text="${user.orElseThrow().getNickname()}"></div>
                                        <span th:text="${message.text}"></span>
                                    </div>
                                    <form th:action="@{/message/v1 (messageId = ${message.id} , chatId = ${message.chat.id})}"
                                          method="post">
                                        <button class="minus">-</button>
                                    </form>
                                </div>
                                <div class="chat-message-left pb-4"
                                     th:if="${message.creator.id != user.orElseThrow().id}">
                                    <div>
                                        <img src="https://bootdey.com/img/Content/avatar/avatar3.png"
                                             class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
                                        <div class="text-muted small text-nowrap mt-2">2:34 am</div>
                                    </div>
                                    <div class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">
                                        <div class="font-weight-bold mb-1" th:text="${message.creator.nickname}"></div>
                                        <span th:text="${message.text}"></span>
                                    </div>
                                    <form th:action="@{/message/v1 (messageId = ${message.id} , chatId = ${message.chat.id})}"
                                          method="post">
                                        <button type="submit" class="minus">-</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--                    MESSAGES-->

                    <div class="flex-grow-0 py-3 px-4 border-top" th:if="${param.chatId != null}">
                        <div class="input-group">
                            <form th:action="@{/message(chatId = ${param.chatId})}" method="post">
                                <label class="input-label">
                                    <input name="textMessage" type="text" required="required" class="form-control"
                                           placeholder="Type your message">
                                </label>
                                <button class="btn btn-primary">Send</button>
                            </form>
                            <div th:if="${errors}">
                                <p th:each="error :${errors}" th:text="${error.defaultMessage}">Error message</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<style>
    body{
        margin-top: 5px;
        background: #009579;
    }
    main {
        height: 100%;
        background: #009579;
        overflow: hidden;
    }

    .btn-primary{

        margin-bottom: 7px;
        margin-left: 3px;
        border-color: seagreen;
        background: #3e8e41;

    }
    .btn-primary2{

        border: 0;
        background: white;

    }
    .minus{
        width: 20px;
        height: 20px;
    //background: #7BDED1;
        border: 2px solid #7BDED1;
        background: rgba(#fff, .9);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #7BDED1;
        font-weight: bold;


    }
    .chat-online {
        color: #3e8e41
    }
    .messages-place {
        min-height: 750px;
        max-height: 750px;
    }

    .chat-messages {
        display: flex;
        flex-direction: column;
        overflow-y: scroll;
        justify-content: flex-end;
        position: relative;
    }
    .chat-messages2 {
        display: flex;
        flex-direction: column;
        max-height: 800px;
        position: relative;
        overflow: auto;
        -ms-overflow-style: none;
        scrollbar-width: none;


    }
    .input-label {
        width: 720px;
    }

    .input-label2{
        width: 130px;
    }

    .chat-message-left,
    .chat-message-right {
        display: flex;
        flex-shrink: 0
    }

    .chat-message-left {
        margin-right: auto
    }

    .chat-message-right {
        flex-direction: row-reverse;
        margin-left: auto
    }
    .py-3 {
        padding-top: 1rem!important;
        padding-bottom: 1rem!important;
    }
    .px-4 {
        padding-right: 1.5rem!important;
        padding-left: 1.5rem!important;
    }
    .flex-grow-0 {
        flex-grow: 0!important;
    }
    .border-top {
        border-top: 1px solid #dee2e6!important;
    }
    .flex-grow-1{
        float: left;

        margin: auto;
    }
    .flex-grow-2{
        float: left;
        margin: auto;
    }


    #drop-window {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
    }

    #window {
        width: 400px;
        height: 230px;
        text-align: center;
        padding: 15px;
        border: 3px solid #3e8e41;
        border-radius: 10px;
        color: #3e8e41;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        background: #fff;
    }

    #drop-window:target {
        display: block;
    }

    .pop-up-window {
        width: 400px;
        height: 230px;
    }


    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    .dropdown-content a:hover {
        background-color: #ddd;
    }

    #chatFromSearch {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
    }

    #windowFromSearch {
        width: 400px;
        height: 230px;
        text-align: center;
        padding: 15px;
        border: 3px solid #3e8e41;
        border-radius: 10px;
        color: #3e8e41;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        background: #fff;
    }
    .pop-up-window {
        width: 400px;
        height: 230px;
    }


    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    .dropdown-content a:hover {
        background-color: #ddd;
    }
    #chatFromSearch:target {
        display: block;
    }
    #AddNewUser {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
    }

    #Adduser {
        width: 400px;
        height: 230px;
        text-align: center;
        padding: 15px;
        border: 3px solid #3e8e41;
        border-radius: 10px;
        color: #3e8e41;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        background: #fff;
    }

    #AddNewUser:target {
        display: block;
    }
</style>
<script type="text/javascript">

</script>
</body>
</html>